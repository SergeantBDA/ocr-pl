# DocOCR (Windows Server 2022 ¬∑ Dramatiq + Memurai/Redis ¬∑ –±–µ–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤)

–ü—Ä–æ—Å—Ç–æ–π –∏ –Ω–∞–¥—ë–∂–Ω—ã–π –∫–æ–Ω–≤–µ–π–µ—Ä —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –ø–æ–¥ **Windows Server 2022 Standard**.
–°–∫–ª–∞–¥—ã–≤–∞–µ—Ç–µ —Ñ–∞–π–ª—ã –≤ `in/` ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ—è–≤–ª—è—é—Ç—Å—è –≤ `out/` (—Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø–æ–¥–∫–∞—Ç–∞–ª–æ–≥–æ–≤).
–û—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á ‚Äî **Dramatiq** —Å –±—Ä–æ–∫–µ—Ä–æ–º **Memurai/Redis**. OCR ‚Äî **Tesseract**. PDF ‚Äî **PyMuPDF (fitz)**.
Watcher ‚Äî —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π, —É—Å—Ç–æ–π—á–∏–≤—ã–π –∫ ¬´–Ω–µ–¥–æ–ø–∏—Å–∞–Ω–Ω—ã–º¬ª —Ñ–∞–π–ª–∞–º –∏ –∞–∫–∫—É—Ä–∞—Ç–Ω—ã–π —Å reparse‚Äë—Ç–æ—á–∫–∞–º–∏ (—Å–∏–º–ª–∏–Ω–∫–∏/–¥–∂–∞–Ω–∫—à–µ–Ω—ã).  
Worker ‚Äî –≥–∏–±—Ä–∏–¥–Ω—ã–π: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Å–ª–æ–π PDF, OCR –¥–µ–ª–∞–µ—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–∫–∞–Ω–æ–≤.

---

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üìÇ –ù–∞–±–ª—é–¥–µ–Ω–∏–µ –∑–∞ `in/` **—Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ** –ø–æ –≤—Å–µ–º –≤–ª–æ–∂–µ–Ω–∏—è–º.
- üß† **–ì–∏–±—Ä–∏–¥–Ω—ã–π OCR –¥–ª—è PDF**:  
  ‚Ä¢ –µ—Å–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Å–ª–æ–π ‚Üí –∏–∑–≤–ª–µ–∫–∞–µ–º —Ç–µ–∫—Å—Ç —á–µ—Ä–µ–∑ `fitz` –∏ –∫–æ–ø–∏—Ä—É–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É **–±–µ–∑ —Ä–∞—Å—Ç—Ä–∏–Ω–≥–∞**;  
  ‚Ä¢ –µ—Å–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ ‚Äî —Å–∫–∞–Ω ‚Üí —Ä–µ–Ω–¥–µ—Ä –æ–¥–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏ OCR —á–µ—Ä–µ–∑ Tesseract (—Ç–æ—á–µ—á–Ω–æ).  
- üìù –í—ã—Ö–æ–¥: `*.txt` –∏/–∏–ª–∏ **searchable** `*.pdf`.
- üß≠ **–ó–µ—Ä–∫–∞–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã**: `in\dept\2024\file.pdf ‚Üí out\dept\2024\file_<hash>.txt/.pdf`.
- üß± –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –æ–±—Ö–æ–¥: **–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–µ –∑–∞—Ö–æ–¥–∏–º** –≤ reparse‚Äë–ø–∞–ø–∫–∏ (—Å–∏–º–ª–∏–Ω–∫–∏/–¥–∂–∞–Ω–∫—à–µ–Ω—ã).
- üîÅ –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ø–æ—Å—Ç–∞–Ω–æ–≤–æ–∫ + –æ–∂–∏–¥–∞–Ω–∏–µ ¬´–¥–æ–∑–∞–ø–∏—Å–∏¬ª —Ñ–∞–π–ª–∞.
- üß© –ó–∞–ø—É—Å–∫ watcher/worker –∫–∞–∫ —Å–ª—É–∂–± Windows (—á–µ—Ä–µ–∑ **NSSM**).

---

## üß© –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
–§–∞–π–ª –ø–æ–ø–∞–ª –≤ IN_DIR (–≤–∫–ª—é—á–∞—è –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –ø–∞–ø–∫–∏)
   ‚Üì (watchdog)
watcher ‚Üí ocr_file.send(path)  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí Memurai/Redis (–æ—á–µ—Ä–µ–¥—å Dramatiq)
                                               ‚Üì
                                        worker —á–∏—Ç–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ
                                               ‚Üì
                         PDF: —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ‚Üí fitz, —Å–∫–∞–Ω—ã ‚Üí Tesseract
                         Image: Tesseract —Ü–µ–ª–∏–∫–æ–º
                                               ‚Üì
                OUT_DIR (–∑–µ—Ä–∫–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞) / ERR_DIR (–æ—à–∏–±–∫–∏) / LOG_DIR (–ª–æ–≥–∏)
```

---

## üßæ –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **Windows Server 2022 Standard** (–ø–æ–¥–æ–π–¥—ë—Ç –∏ Windows 10/11 –¥–ª—è —Ç–µ—Å—Ç–∞).
- **Python 3.11 (x64)**.
- **Tesseract OCR** (–∏ –Ω—É–∂–Ω—ã–µ —è–∑—ã–∫–∏, –Ω–∞–ø—Ä. `rus`).
- **Memurai** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è) –∏–ª–∏ Redis (—á–µ—Ä–µ–∑ WSL).  
- **NSSM** ‚Äî –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –¥–ª—è —Å–ª—É–∂–±.

---

## üì¶ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
C:\DocOCR\
  in\
  out\
  err\
  logs\
  venv\
  app\
    __init__.py
    utils.py
    watcher.py        # —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π, —Å onerror, –ø—Ä–æ–ø—É—Å–∫–æ–º reparse (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
    workers.py        # –≥–∏–±—Ä–∏–¥: fitz-—Ç–µ–∫—Å—Ç + OCR —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–∫–∞–Ω–æ–≤; –∑–µ—Ä–∫–∞–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
  requirements.txt
  .env
  start_worker.bat
  start_watcher.bat
  setup.bat
```

---

## üîß –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1) **Tesseract** ‚Üí `C:\Program Files\Tesseract-OCR\`  
   –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
   ```bat
   "C:\Program Files\Tesseract-OCR\tesseract.exe" --version
   ```

2) **Memurai** (Developer Edition) ‚Äî —Å—Ç–∞–≤–∏—Ç—Å—è –∫–∞–∫ —Å–ª—É–∂–±–∞ `Memurai` (–ø–æ—Ä—Ç `6379`).  
   –ü—Ä–æ–≤–µ—Ä–∫–∞:
   ```powershell
   Test-NetConnection localhost -Port 6379
   "C:\Program Files\Memurai\memurai-cli.exe" -h localhost -p 6379 ping
   ```
   –û–∂–∏–¥–∞–µ—Ç—Å—è `TcpTestSucceeded : True` –∏ `PONG`.

3) **Python‚Äë–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**:
   ```bat
   C:\DocOCR\setup.bat
   ```

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (`.env`)

```ini
# –ë—Ä–æ–∫–µ—Ä Dramatiq
REDIS_URL=redis://localhost:6379/0

# –ö–∞—Ç–∞–ª–æ–≥–∏
IN_DIR=C:\DocOCR\in
OUT_DIR=C:\DocOCR\out
ERROR_DIR=C:\DocOCR\err
LOG_DIR=C:\DocOCR\logs

# Tesseract
TESSERACT_EXE=C:\Program Files\Tesseract-OCR\tesseract.exe
OCR_LANG=eng+rus
TESSERACT_CONFIG=--psm 6           # –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –º–µ–Ω—å—à–µ –ª–æ–∂–Ω—ã—Ö –ø–µ—Ä–µ–Ω–æ—Å–æ–≤ –≤ OCR

# –í—ã—Ö–æ–¥–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã
OUTPUT_TXT=1
OUTPUT_PDF=1

# –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
OCR_THREADS=2                      # –ø–æ—Ç–æ–∫–∏ OCR –¥–ª—è —Å–∫–∞–Ω‚Äë—Å—Ç—Ä–∞–Ω–∏—Ü
OCR_DPI=300                        # DPI —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–∫–∞–Ω–æ–≤
TEXT_MIN_CHARS=16                  # –ø–æ—Ä–æ–≥ "–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –µ—Å—Ç—å —Ç–µ–∫—Å—Ç"

# Watcher (—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∏ —Ä–µ–∫—É—Ä—Å–∏—è)
DIR_SETTLE_SEC=2                   # –∑–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ —Å–∫–∞–Ω–æ–º —Å–æ–∑–¥–∞–Ω–Ω–æ–π –ø–∞–ø–∫–∏
FILE_WAIT_RETRIES=40               # 40*0.5 ‚âà 20 —Å–µ–∫ –æ–∂–∏–¥–∞–Ω–∏—è "–¥–æ–∑–∞–ø–∏—Å–∏"
FILE_WAIT_STEP=0.5
FOLLOW_REPARSE=0                   # 0 ‚Äî –Ω–µ –∑–∞—Ö–æ–¥–∏—Ç—å –≤ —Å–∏–º–ª–∏–Ω–∫–∏/–¥–∂–∞–Ω–∫—à–µ–Ω—ã; 1 ‚Äî –∑–∞—Ö–æ–¥–∏—Ç—å (–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ)
EXCLUDE_DIRS=$recycle.bin,System Volume Information,__pycache__,.git
```

> –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ `...Tesseract-OCR\tessdata\` –ª–µ–∂–∞—Ç `eng.traineddata`, `rus.traineddata` –∏ –¥—Ä. –Ω—É–∂–Ω—ã–µ —è–∑—ã–∫–∏.

---

## ‚ñ∂Ô∏è –ó–∞–ø—É—Å–∫ (–ª–æ–∫–∞–ª—å–Ω–æ)

–û—Ç–∫—Ä–æ–π—Ç–µ –¥–≤–∞ –æ–∫–Ω–∞:

```bat
C:\DocOCR\start_worker.bat
C:\DocOCR\start_watcher.bat
```

- Worker –ø–æ–¥–Ω–∏–º–µ—Ç Dramatiq –∏ –ø–æ–¥–∫–ª—é—á–∏—Ç—Å—è –∫ Memurai/Redis.  
- Watcher –Ω–∞—á–Ω—ë—Ç —Å–ª–µ–¥–∏—Ç—å –∑–∞ `IN_DIR` **—Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ** –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç —Å—Ç–∞—Ä—Ç–æ–≤—ã–π —Å–∫–∞–Ω —É–∂–µ –∏–º–µ—é—â–∏—Ö—Å—è —Ñ–∞–π–ª–æ–≤.

–õ–æ–≥–∏: `C:\DocOCR\logs\dococr.log` (–∏ `worker.out/err.log`, `watcher.out/err.log`, –µ—Å–ª–∏ —á–µ—Ä–µ–∑ NSSM).

---

## üß∞ –ó–∞–ø—É—Å–∫ –∫–∞–∫ —Å–ª—É–∂–±—ã (NSSM)

**Worker**
```bat
C:\Tools\nssm\nssm.exe install DocOCR-Worker "C:\DocOCR\venv\Scripts\python.exe" -m dramatiq app.workers -p 1 -t 2
C:\Tools\nssm\nssm.exe set DocOCR-Worker AppDirectory C:\DocOCR
C:\Tools\nssm\nssm.exe set DocOCR-Worker AppStdout C:\DocOCR\logs\worker.out.log
C:\Tools\nssm\nssm.exe set DocOCR-Worker AppStderr C:\DocOCR\logs\worker.err.log
C:\Tools\nssm\nssm.exe start DocOCR-Worker
```

**Watcher**
```bat
C:\Tools\nssm\nssm.exe install DocOCR-Watcher "C:\DocOCR\venv\Scripts\python.exe" -m app.watcher
C:\Tools\nssm\nssm.exe set DocOCR-Watcher AppDirectory C:\DocOCR
C:\Tools\nssm\nssm.exe set DocOCR-Watcher AppStdout C:\DocOCR\logs\watcher.out.log
C:\Tools\nssm\nssm.exe set DocOCR-Watcher AppStderr C:\DocOCR\logs\watcher.err.log
C:\Tools\nssm\nssm.exe start DocOCR-Watcher
```

> –ó–∞–¥–∞–π—Ç–µ —É—á—ë—Ç–∫—É —Å–ª—É–∂–±—ã –∏ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.

---

## üß† –î–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### Watcher (`app/watcher.py`)
- `watchdog` + `os.walk(topdown=True, followlinks=False, onerror=...)`.
- **Pruning**: –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –∫–∞—Ç–∞–ª–æ–≥–∏ –∏–∑ `EXCLUDE_DIRS` –∏ –ª—é–±—ã–µ reparse‚Äë–ø–∞–ø–∫–∏ (—Å–∏–º–ª–∏–Ω–∫–∏/–¥–∂–∞–Ω–∫—à–µ–Ω—ã) –ø—Ä–∏ `FOLLOW_REPARSE=0`.
- –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –∑–∞–¥–∞—á, –æ–∂–∏–¥–∞–Ω–∏–µ —Å—Ç–∞–±–∏–ª—å–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞, —Å—Ç–∞—Ä—Ç–æ–≤—ã–π —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π —Å–∫–∞–Ω.

### Worker (`app/workers.py`)
- –ê–∫—Ç–æ—Ä `ocr_file` —É Dramatiq (`time_limit` –≤ **–º—Å**; –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 8 —á–∞—Å–æ–≤ —á–µ—Ä–µ–∑ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä –∏ middleware).
- **–ì–∏–±—Ä–∏–¥ PDF**:  
  ‚Ä¢ –¢–µ–∫—Å—Ç–æ–≤—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ‚Üí `fitz.get_text("blocks", sort=True)` + –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ (`preprocess_text_layer`), –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤ –≤—ã—Ö–æ–¥–Ω–æ–π PDF **–±–µ–∑ —Ä–∞—Å—Ç—Ä–∏–Ω–≥–∞**.  
  ‚Ä¢ –°–∫–∞–Ω‚Äë—Å—Ç—Ä–∞–Ω–∏—Ü—ã ‚Üí —Ä–µ–Ω–¥–µ—Ä –æ–¥–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã (`OCR_DPI`) ‚Üí `pytesseract` (`OCR_LANG`, `TESSERACT_CONFIG`) ‚Üí –≤—Å—Ç–∞–≤–∫–∞ single‚Äëpage OCR‚ÄëPDF –≤ –∏—Ç–æ–≥.  
- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: OCR —á–µ—Ä–µ–∑ Tesseract —Ü–µ–ª–∏–∫–æ–º.
- **–ó–µ—Ä–∫–∞–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—É—Ç–µ–π**: `OUT_DIR / relpath(from=IN_DIR)`.

### –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞ (`preprocess_text_layer`)
- –°–∫–ª–µ–π–∫–∞ –ø–µ—Ä–µ–Ω–æ—Å–æ–≤ –ø–æ –¥–µ—Ñ–∏—Å—É.
- –ü—Ä–µ–≤—Ä–∞—â–µ–Ω–∏–µ **–æ–¥–∏–Ω–æ—á–Ω–æ–≥–æ** `\n` –≤ –ø—Ä–æ–±–µ–ª, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∞–±–∑–∞—Ü–µ–≤ (`\n\n`).  
- –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–±–µ–ª–æ–≤ (–≤–∫–ª. NBSP).

---

## üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞

1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±—Ä–æ–∫–µ—Ä:
   ```powershell
   Test-NetConnection localhost -Port 6379
   "C:\Program Files\Memurai\memurai-cli.exe" -h localhost -p 6379 ping
   ```
2. –ü–æ–ª–æ–∂–∏—Ç—å `PDF/JPG` –≤ `in\` (–∏–ª–∏ `in\dept\2024\`).
3. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤ `out\dept\2024\` –ø–æ—è–≤–∏–ª–∏—Å—å `*.txt` –∏/–∏–ª–∏ `*.pdf`.
4. –û—à–∏–±–æ—á–Ω—ã–µ —Ñ–∞–π–ª—ã –æ–∫–∞–∂—É—Ç—Å—è –≤ `err\` ‚Äî –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –≤ `logs\dococr.log`.

---

## üõ†Ô∏è –¢—é–Ω–∏–Ω–≥ –∏ —Å–æ–≤–µ—Ç—ã

- **–í—Ä–µ–º—è**: `time_limit` —É–∫–∞–∑—ã–≤–∞–π—Ç–µ –≤ **–º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö** (–ø—Ä–∏–º–µ—Ä: `8 * 60 * 60 * 1000`).
- **–°–∫–æ—Ä–æ—Å—Ç—å/–∫–∞—á–µ—Å—Ç–≤–æ OCR**:  
  ‚Ä¢ `OCR_THREADS` ‚Äî 2‚Äì4;  
  ‚Ä¢ `OCR_DPI` ‚Äî 300 (200 –±—ã—Å—Ç—Ä–µ–µ, 400‚Äì600 –ª—É—á—à–µ –¥–ª—è –º–µ–ª–∫–æ–≥–æ —à—Ä–∏—Ñ—Ç–∞);  
  ‚Ä¢ `TESSERACT_CONFIG="--psm 6"` (–∏–ª–∏ 4 ‚Äî –¥–ª—è –º–Ω–æ–≥–æ‚Äë–∫–æ–ª–æ–Ω–æ—á–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞).
- **–î–µ—Ç–µ–∫—Ç–æ—Ä —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ —Å–ª–æ—è**: `TEXT_MIN_CHARS` –ø–æ–¥—Å—Ç—Ä–∞–∏–≤–∞–π—Ç–µ –ø–æ–¥ –≤–∞—à–∏ PDF.
- **–ë–æ–ª—å—à–∏–µ PDF**: –ø–æ–¥—É–º–∞–π—Ç–µ –æ —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–∏ (—Å—Ç–∞–≤–∏—Ç—å –≤ –æ—á–µ—Ä–µ–¥—å –±–∞—Ç—á–∏ —Å—Ç—Ä–∞–Ω–∏—Ü).

---

## ü©∫ –†–∞–∑–±–æ—Ä —Ç–∏–ø–∏—á–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º

- **–í out/ –Ω–∏—á–µ–≥–æ –Ω–µ—Ç**  
  ‚Ä¢ –†–∞–∑–Ω—ã–µ –∫–æ—Ä–Ω–∏ —É watcher/worker (–ø—Ä–æ–≤–µ—Ä—å—Ç–µ `cd` –≤ `.bat` –∏ –ø—É—Ç–∏ –≤ `.env`).  
  ‚Ä¢ Memurai –Ω–µ –∑–∞–ø—É—â–µ–Ω –∏–ª–∏ –ø–æ—Ä—Ç –∑–∞–Ω—è—Ç.  
  ‚Ä¢ –ü—Ä–∞–≤–∞ –Ω–∞ –ø–∞–ø–∫–∏/—Å–ª—É–∂–±—É.

- **`TimeLimitExceeded` –ø–æ—á—Ç–∏ —Å—Ä–∞–∑—É**  
  ‚Ä¢ –õ–∏–º–∏—Ç –∑–∞–¥–∞–Ω –≤ —Å–µ–∫—É–Ω–¥–∞—Ö –≤–º–µ—Å—Ç–æ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥. –ü—Ä–∏–º–µ—Ä –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ: `8 * 60 * 60 * 1000`.

- **–¢–µ–∫—Å—Ç ¬´–ª–µ—Å–µ–Ω–∫–æ–π¬ª (–∫–∞–∂–¥–æ–µ —Å–ª–æ–≤–æ —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏)**  
  ‚Ä¢ –≠—Ç–æ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç PDF. –í `preprocess_text_layer` –ø—Ä–µ–≤—Ä–∞—â–∞–µ–º –æ–¥–∏–Ω–æ—á–Ω—ã–π `\n` –≤ –ø—Ä–æ–±–µ–ª –∏ —Å–∫–ª–µ–∏–≤–∞–µ–º –¥–µ—Ñ–∏—Å—ã.  
  ‚Ä¢ –î–ª—è OCR –¥–æ–±–∞–≤—å—Ç–µ `TESSERACT_CONFIG=--psm 6`.

- **`TesseractError` / –ø—É—Å—Ç–æ–π OCR**  
  ‚Ä¢ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ `*.traineddata` –≤ `tessdata`.  
  ‚Ä¢ –ü–æ–¥—Å—Ç—Ä–æ–π—Ç–µ `OCR_DPI`/`--psm`.  

- **–û—á–µ—Ä–µ–¥—å –∑–∞–±–∏—Ç–∞**  
  ```bat
  "C:\Program Files\Memurai\memurai-cli.exe" -h localhost -p 6379 LRANGE dramatiq:queue:default 0 -1
  ```

---

## üìú –õ–∏—Ü–µ–Ω–∑–∏—è

MIT/Apache 2.0

---

## üß≠ –®–ø–∞—Ä–≥–∞–ª–∫–∞ (–±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç)

```bat
:: 1) –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
C:\DocOCR\setup.bat

:: 2) –ü—Ä–æ–≤–µ—Ä–∫–∞ Memurai
Test-NetConnection localhost -Port 6379
"C:\Program Files\Memurai\memurai-cli.exe" -h localhost -p 6379 ping

:: 3) –ó–∞–ø—É—Å–∫
C:\DocOCR\start_worker.bat
C:\DocOCR\start_watcher.bat

:: 4) –¢–µ—Å—Ç: —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å PDF –≤ C:\DocOCR\in\dept\2024\
:: 5) –ü—Ä–æ–≤–µ—Ä–∏—Ç—å C:\DocOCR\out\dept\2024\
```
